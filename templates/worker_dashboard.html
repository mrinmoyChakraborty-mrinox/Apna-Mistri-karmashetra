{% extends "base.html" %}
{% block content %}
    <meta charset="UTF-8">
    <title>Worker Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/worker_dashboard.css') }}">
<body>

<!-- ================= WORKER DASHBOARD ================= -->

<!-- ===== WELCOME SECTION ===== -->
<section class="welcome-section">
    <div class="welcome-left">
        <h2>Welcome back, <span id="workerName">{{ user.name }}</span> üëã</h2>
    </div>

    <div class="welcome-right">
        <label class="toggle-switch">
            <input type="checkbox" name="online_status" id="onlineToggle" checked>
            <span class="slider"></span>
        </label>
        <span id="statusText">online</span>
         <!-- NEW BUTTON -->
        <button id="updateLocationBtn" class="location-btn">
            üìç Update Work Location
        </button>
    </div>
</section>


<!-- ===== TOP SUMMARY CARDS ===== -->
<section class="top-cards">

    <div class="summary-card purple-card">
        <div class="card-icon">üõ†</div>
        <h3>Active Jobs</h3>
        <p id="activeJobsCount"></p>
    </div>

    <div class="summary-card blue-card">
        <div class="card-icon">‚≠ê</div>
        <h3>Rating</h3>
        <p id="workerRating"></p>
    </div>

    <div class="summary-card yellow-card clickable-card" id="openCalendar">
        <div class="card-icon">üìÖ</div>
        <h3>Calendar</h3>
    </div>

    <div class="summary-card green-card clickable-card" onclick="window.location.href='/inbox'">
        <div class="card-icon">üí¨</div>
        <h3>Messages</h3>
    </div>

</section>


<!-- ===== NEW REQUESTS + PERFORMANCE ===== -->
<section class="grid-60-40">

    <!-- ===== NEW JOB REQUESTS ===== -->
    <div class="card-section">

        <div class="section-header">
            <h3>New Job Requests</h3>
            <button type="button" id="viewAllRequests" class="view-all-btn">
                View All
            </button>
        </div>

        <div id="incomingRequests">

            <!--  <div class="job-card urgent-job">
                <span class="job-badge new-badge">NEW</span>

                <p><strong>Customer:</strong> Customer Name</p>
                <p><strong>Job Type:</strong> job name</p>
                <p><strong>Location:</strong> place name </p>
                <p><strong>Price Offered:</strong> ‚Çπ00</p>

                <p class="countdown" data-expiry="2026-02-28T18:00:00">
                    Expires in: <span class="timer">--:--:--</span>
                </p>

                <div class="job-actions">
                    <button class="btn primary">Accept</button>
                    <button class="btn danger">Decline</button>
                    <button class="btn outline">View Details</button>
                </div>
            </div>-->

        </div>
    </div>


    <!-- ===== PERFORMANCE SECTION ===== 
    <div class="card-section performance-section">

        <h3>My Performance</h3>

        <div class="performance-stats">
            <p>Average Rating: <strong>4.8 ‚≠ê</strong></p>
            <p>Cancellation Rate: <strong>2%</strong></p>
        </div>

        <div class="progress-circles">

            <div class="circle-container">
                <div class="circle" data-percent="97">
                    <span>97%</span>
                </div>
                <p>Completion Rate</p>
            </div>

            <div class="circle-container">
                <div class="circle" data-percent="95">
                    <span>95%</span>
                </div>
                <p>On-time Arrival</p>
            </div>

        </div>

    </div>-->

</section>


<!-- ===== ONGOING + RECENT ===== -->
<section class="grid-50-50">

    <!-- ===== ONGOING JOBS =====
    <div class="card-section ongoing-card">
        <h3>Ongoing Job</h3>

        <div class="ongoing-details">
            <p><strong>Job:</strong> Electrical Fix</p>
            <p><strong>Customer:</strong> Customer Name</p>
            <p><strong>Started:</strong> 10:30 AM</p>
            <p><strong>Estimated Completion:</strong> 2:00 PM</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" style="width: 70%;"></div>
        </div>

        <div class="job-actions">
            <button class="btn outline">Open Details</button>
            <button class="btn primary">Mark Completed</button>
        </div>
    </div> -->
    <div class="card-section ongoing-card">
    <h3>Ongoing Job</h3>
    <div id="ongoingJobBox"></div>
    </div>



    <!-- ===== RECENT CHATS ===== -->
    <div class="card-section">

        <div class="section-header">
            <h3>Recent Chats</h3>
            <a href="/inbox" class="view-all-link">View All</a>
        </div>

        <div class="chat-preview" id="recentChatsContainer">
            <!--<div class="chat-item" onclick="window.location.href='/inbox'">
                <div class="chat-avatar">üë§</div>
                <div class="chat-info">
                    <strong>Customer Name</strong>
                    <p>Hello, please arrive early...</p>
                </div>
                <div class="chat-time">2:30 PM</div>
            </div>-->
        </div>

    </div>

</section>


<!-- ===== JOB HISTORY ===== -->
<section class="card-section">

    <div class="section-header">
        <h3>Job History</h3>

        <select id="historyFilter">
            <option value="all">All Dates</option>
            <option value="7">Last 7 Days</option>
            <option value="30">Last 30 Days</option>
        </select>
    </div>

    <div class="tabs">
        <button class="tab-btn active" data-status="Completed">Completed</button>
        <button class="tab-btn" data-status="Cancelled">Cancelled</button>
        <button class="tab-btn" data-status="Disputed">Disputed</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Job</th>
                <th>Customer</th>
                <th>Status</th>
                <th>Rating</th>
            </tr>
        </thead>
        <tbody id="historyTableBody">

        </tbody>
    </table>

</section>


<!-- ===== CALENDAR MODAL ===== -->
<div id="calendarModal" class="calendar-modal">

    <div class="calendar-content">

        <div class="calendar-header">
            <button id="prevMonth">‚óÄ</button>
            <h3 id="calendarMonthYear">Month Year</h3>
            <button id="nextMonth">‚ñ∂</button>
        </div>

        <div class="calendar-legend">
            <span class="legend-item start-date">Start</span>
            <span class="legend-item middle-date">Ongoing</span>
            <span class="legend-item end-date">End</span>
        </div>

        <div id="calendarGrid" class="calendar-grid"></div>

        <div id="calendarJobDetails" class="calendar-job-details">
            <!-- Jobs for selected date will appear here -->
        </div>

        <span class="close-calendar" id="closeCalendar">&times;</span>

    </div>

</div>

<!-- ===== LOCATION MODAL ===== -->
<div id="locationModal" class="calendar-modal">
    <div class="calendar-content">
        <h3>Update Work Location</h3>
        <div id="workerLocationMap" style="height:400px;"></div>
        <button id="saveWorkerLocation" class="btn primary">
            Save Location
        </button>
        <span class="close-calendar" id="closeLocationModal">&times;</span>
    </div>
</div>

<link rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="../static/js/worker_dashboard.js"></script>

</body>
{% endblock %}